# Production Kafka Configuration
# Optimized for high availability, performance, and fault tolerance

############################# Server Basics #############################

# The id of the broker. This must be set to a unique integer for each broker.
# NOTE: This will be overridden by environment variables in Docker Compose
broker.id=1

# Enable KRaft mode (no Zookeeper)
process.roles=broker,controller
node.id=1
controller.quorum.voters=1@kafka-1:29093,2@kafka-2:29093,3@kafka-3:29093

############################# Socket Server Settings #############################

# The address the socket server listens on
listeners=PLAINTEXT://kafka-1:29092,CONTROLLER://kafka-1:29093,PLAINTEXT_HOST://0.0.0.0:9092
advertised.listeners=PLAINTEXT://kafka-1:29092,PLAINTEXT_HOST://localhost:9092

# Maps listener names to security protocols
listener.security.protocol.map=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT,SSL:SSL

# Name of listener used for communication between brokers
inter.broker.listener.name=PLAINTEXT

# Listener name for the controller
controller.listener.names=CONTROLLER

# The number of threads that the server uses for receiving requests from the network and sending responses to the network
num.network.threads=8

# The number of threads that the server uses for processing requests, which may include disk I/O
num.io.threads=8

# Background threads for various tasks
background.threads=20

# The send buffer (SO_SNDBUF) used by the socket server
socket.send.buffer.bytes=102400

# The receive buffer (SO_RCVBUF) used by the socket server
socket.receive.buffer.bytes=102400

# The maximum size of a request that the socket server will accept (protection against OOM)
socket.request.max.bytes=104857600

############################# Log Basics #############################

# A comma separated list of directories under which to store log files
log.dirs=/var/lib/kafka/data

# The default number of log partitions per topic
num.partitions=3

# The number of threads per data directory to be used for log recovery at startup and flushing at shutdown
num.recovery.threads.per.data.dir=2

############################# Internal Topic Settings  #############################

# The replication factor for the group metadata internal topics "__consumer_offsets" and "__transaction_state"
offsets.topic.replication.factor=3
transaction.state.log.replication.factor=3
transaction.state.log.min.isr=2

# Default replication factor for automatically created topics
default.replication.factor=3

# Minimum in-sync replicas for a partition
min.insync.replicas=2

############################# Log Flush Policy #############################

# The number of messages to accept before forcing a flush of data to disk
log.flush.interval.messages=10000

# The maximum amount of time a message can sit in a log before we force a flush
log.flush.interval.ms=1000

############################# Log Retention Policy #############################

# The minimum age of a log file to be eligible for deletion due to age (30 days)
log.retention.hours=720

# The maximum size of a log segment file. When this size is reached a new log segment will be created (1GB)
log.segment.bytes=1073741824

# The maximum size of the log before deleting old log segments (10GB)
log.retention.bytes=10737418240

# The interval at which log segments are checked to see if they can be deleted
log.retention.check.interval.ms=300000

############################# Group Coordinator Settings #############################

# The following configuration specifies the time, in milliseconds, that the GroupCoordinator will delay the initial consumer rebalance.
group.initial.rebalance.delay.ms=3000

############################# Production Settings #############################

# Disable auto creation of topics in production
auto.create.topics.enable=false

# Enable topic deletion
delete.topic.enable=true

# Disable unclean leader election for data consistency
unclean.leader.election.enable=false

# Compression type for better performance
compression.type=snappy

# Log cleanup policy
log.cleanup.policy=delete

# Producer acknowledgment level
acks=all

# Enable idempotent producer
enable.idempotence=true

# Maximum in-flight requests per connection
max.in.flight.requests.per.connection=5

# Retry configuration
retries=2147483647
retry.backoff.ms=100

# Request timeout
request.timeout.ms=30000

# Delivery timeout
delivery.timeout.ms=120000

############################# Replication Settings #############################

# Replica lag time that determines whether a replica is in sync
replica.lag.time.max.ms=30000

# Replica fetch settings
replica.fetch.max.bytes=1048576
replica.fetch.min.bytes=1
replica.fetch.wait.max.ms=500

# Leader imbalance settings
leader.imbalance.per.broker.percentage=10
leader.imbalance.check.interval.seconds=300
auto.leader.rebalance.enable=true

############################# Security Settings #############################

# Security protocol for inter-broker communication
security.inter.broker.protocol=PLAINTEXT

# SASL mechanism for inter-broker communication
sasl.mechanism.inter.broker.protocol=PLAIN

# SSL settings (can be enabled for production)
# ssl.keystore.location=/etc/kafka/security/kafka.server.keystore.jks
# ssl.keystore.password=password
# ssl.key.password=password
# ssl.truststore.location=/etc/kafka/security/kafka.server.truststore.jks
# ssl.truststore.password=password
# ssl.client.auth=required
# ssl.enabled.protocols=TLSv1.2
# ssl.keystore.type=JKS
# ssl.truststore.type=JKS

############################# Performance Tuning #############################

# Batch size for producer
batch.size=16384

# Linger time for producer
linger.ms=5

# Buffer memory for producer
buffer.memory=33554432

# Consumer settings
fetch.min.bytes=1
fetch.max.wait.ms=500
max.poll.records=500

# Connection settings
connections.max.idle.ms=600000
reconnect.backoff.ms=50
reconnect.backoff.max.ms=1000

############################# JMX Settings #############################

# JMX port for monitoring
jmx.port=9101

############################# Metrics #############################

# Metrics settings for monitoring
metric.reporters=
metrics.num.samples=2
metrics.sample.window.ms=30000
metrics.recording.level=INFO